<html>
 <head>
    <meta charset="UTF-8">
    <!-- https://blueprintcss.dev/docs -->
    <link href="https://unpkg.com/blueprint-css@3.1.3/dist/blueprint.min.css" rel="stylesheet" />


    <!--Load the AJAX API for visualizing stacked bars-->
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

    <!-- JQuery -->
    <script src="https://code.jquery.com/jquery-3.6.4.min.js" integrity="sha256-oP6HI9z1XaZNBrJURtCoUT5SUnxFr8s3BzRl+cbzUq8=" crossorigin="anonymous"></script>

    <!-- Pagination via CDN -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/paginationjs/2.1.5/pagination.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/paginationjs/2.1.5/pagination.js">
    </script>
  <title>$test_type with $exec</title>
  <style>
    body {   font-family: Sans-Serif; }

    table, th, td {
    border: 1px solid black;
    border-collapse: collapse;
    padding: 15px;
    text-align: center;
    }

    body {   font-family: Sans-Serif; }

    table, th, td {
    border: 1px solid black;
    border-collapse: collapse;
    padding: 15px;o
    text-align: center;
    }
  </style>

    <!--Load the AJAX API for visualizing stacked bars-->
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

    <!-- JQuery -->
<script src="https://code.jquery.com/jquery-3.6.4.min.js" integrity="sha256-oP6HI9z1XaZNBrJURtCoUT5SUnxFr8s3BzRl+cbzUq8=" crossorigin="anonymous"></script>
    <script type="text/javascript">

      // Load the Visualization API and the corechart package.
      google.charts.load('current', {'packages':['corechart']});

      // Set a callback to run when the Google Visualization API is loaded.
      google.charts.setOnLoadCallback(drawChart);

     // Callback that creates and populates a data table
     // Instantiates it with data, and draws it.
     // TODO: Update with all the data loaded
     function drawChart() {
       // For each test type:
       //   Get a div for the chart
       let chart = document.getElementById('chart_div')
       //   Create data for each executor in all versions under that test type
       //   Set up options and links
       //   Get the div where the output should be drawn s chart
       if (chart) {
         chart.draw(data, options);
       }
     }
</script>

    <script>
    function toggleElement(id) {
      const element = document.getElementById(id);
      if (element.style.display === "none") {
        element.style.display = "block";
      } else {
        element.style.display = "none";
      }
    }

    const characterized_failure_labels =
      $characterized_failure_labels;

    let selectedSet = null;
    let accum_boxes = [];
    function checkboxChanged(box) {
      // Update the group selected with the intersection of values
      selectedSet = null;
      let first = true;
      for (let index in characterized_failure_labels) {
        const tag = characterized_failure_labels[index];
        const check_item = document.getElementById(tag);
        if (check_item.checked) {
          const label_string = check_item.value;
          const str_len = label_string.length;
          const labels = label_string.substring(2, str_len - 2). split("', '");
          const newSet = new Set(labels);

          if (first) {
             selectedSet = newSet;
             first = false;
          } else {
             selectedSet = new Set([...selectedSet].filter((x) => newSet.has(x)));
          }
        }
      }
     // Do something with the selected set.
     const newSize = selectedSet == null ? 0 : selectedSet.size;
     const output = document.getElementById('selectedCount');
     if (output) output.innerHTML = output.value = newSize;
     return newSize;
    }

    function showSelectedItems() {
      // Take the selected set and turn on row with that label in the tables.
      // Turn off the others.

      // If no items are selected, however, show all rows.
      let all_tr_elements = document.body.getElementsByTagName("tr");
      if (selectedSet == null || selectedSet.length == 0) {
        // Turn everything on!
        for (let index in all_tr_elements) {
          let element = all_tr_elements[index];
          if (element.style) {
            element.style.visibility = "visible";
            element.style.display = "table-row";
          }
        }
        return;
      }
      for (let index in all_tr_elements) {
        // Display only those selected.
        let element = all_tr_elements[index];
        const id = element.id;
        if (id) {
          if (selectedSet.has(id)) {
            // Show it
              if (element.style) {
                element.style.visibility = "visible";
                element.style.display = "table-row";
              }
            } else {
            // Turn it off
            if (element.style) {
              element.style.visibility = "collapse";
              //element.style.display = "none";
            }
          }
        }
      }
    }

    function loadJson(json_data) {

    }

    // UL Template for pagination
    function simpleTemplating(data) {
        var html = '<ul>';
        $.each(data, function(index, item){
            html += '<li>'+ item +'</li>';
        });
        html += '</ul>';
        return html;
    }

    function onloadFn() {
     // Set up the pagination of each set of results
     // Start with the failures
      $('#failing-pagination-container').pagination({
          dataSource: fail_json,
          pageSize: 7,
          showGoInput: true,
          showGoButton: true,
          showNavigator: true,
          formatGoInput: 'go to page <%= input %> st/rd/th',
          formatNavigator: '<%= rangeStart %>-<%= rangeEnd %> of <%= totalNumber %> items',
          position: 'top',
          showSizeChanger: true,
          callback: function(data, pagination) {
              // template method of yourself
              var html = simpleTemplating(data);
              $('#failing-data-container').html(html);
              }
        })
    }

    // Get the JSON data from the tests.
    let pass_json;
    let fail_json;
    let error_json;
    let unsupported_json;

    fetch('./pass/pass.json')
      .then((response) => response.json())
      .then((data) => {pass_json = data});
    fetch('./failing_tests/failing_tests.json')
      .then((response) => response.json())
      .then((data) => {fail_json = data});
    fetch('./test_errors/test_errors.json')
      .then((response) => error_json = response.json())
      .then((data) => {error_json = data});
    fetch('./unsupported/unsupported.json')
      .then((response) => unsupportd_json = response.json())
      .then((data) => {unsupported_json = data});
</script>
  </head>
  <body onload=onloadFn()>
    <h1>Verification report: $test_type on $exec</h1>
    <h2>Test details</h2>
    <details>
      <summary>
    <p>$platform_info</p>
<p>Open for details</p>
</summary>
    <p>$test_environment</p>
</details>
    <p>Result file created: $timestamp
    <h2>Test summary</h2>
    <p>Total: $total_tests.
    <p>Pass: $passing_tests, Fail: $failing_tests, Errors: $error_count, Unsupported: $unsupported_count</p>
    <h2 id='passingTests'>Passing tests</h2>
    <button onclick="loadJson('./pass/pass.json')">Load passing tests</button>

    <h2>Passing data</h2>
    <!-- Using pagination.js -->
    <div id="passing-data-container"></div>
    <div id="passing-pagination-container"></div>

<h2 id='testErrors'>Test Errors ($error_count)</h2>
    <h3>Summary of test errors</h3>
    $error_summary
    <div id="errors-data-container"></div>
    <div id="errors-pagination-container"></div>

    <details>
    <summary>Open for all test errors</summary>
    <h3>All errors</h3>
   <div bp="grid">
     <div bp="16">
   $error_section
     </div>
     <div bp="6">
       Summary details
     </div>
   </div>
    </details>

    <h2 id='testUnsupported'>Unsupported Tests  ($unsupported_count)</h2>
<h3>Summary of unsupported</h3>
    $unsupported_summary
<details>
<summary>Open for all unsupported tests</summary>
    <h3>All unsupported results</h3>
    $unsupported_section
</details>

<table id='passing_tests_table' >
    <tr><th style="width:10%">Label</th><th style="width:20%">Expected result</th><th style="width:20%">Actual result</th><th>Test input</th></tr>
      <!-- For each passing test, create the output line with label
           -->
</table>

<h2 id='testFailures'>Failing tests detail ($failing_tests)</h2>
    <div id="failing-data-container"></div>
    <div id="failing-pagination-container"></div>

    <details>
       <summary>Open for all failing tests.</summary>
<div bp="grid">
  <div bp="20">
<table id='failing_tests_table' >
    <tr><th style="width:10%">Label</th><th style="width:20%">Expected result</th><th style="width:20%">Actual result</th><th>Test input</th></tr>
      <!-- For each failing test, output row with columns
           label, expected, actual, difference -->
$failure_table_lines
</table>
  </div>
  <div bp="4">
    <h3>Failures characterized</h3>
    <p>Filtered count = <span id='selectedCount'>0</span>
    <button id="showSelected" onclick="showSelectedItems();">"Update display"</button>
    </p>$failures_characterized

<h2>Unsupported tests</h2>
    <div id="unsupported-data-container"></div>
    <div id="unsupported-pagination-container"></div>
</div>
</div>
    </details>
</body>
</html>
